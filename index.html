<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astrodon Quartet - Home</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://astrodonquartet.com/">
    <meta property="og:title" content="Astrodon Quartet - Baltimore String Quartet">
    <meta property="og:description" content="Professional string quartet in Baltimore, MD. Part of Mount Vernon Virtuosi fellowship program performing free concerts and teaching music throughout the community.">
    <meta property="og:image" content="https://astrodonquartet.com/assets/images/site-preview.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://astrodonquartet.com/">
    <meta property="twitter:title" content="Astrodon Quartet - Baltimore String Quartet">
    <meta property="twitter:description" content="Professional string quartet in Baltimore, MD. Part of Mount Vernon Virtuosi fellowship program performing free concerts and teaching music throughout the community.">
    <meta property="twitter:image" content="https://astrodonquartet.com/assets/images/site-preview.jpg">

    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Fugaz+One&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="components/components.js"></script>
    <script src="utils.js"></script>
    <script>
        // Load next concert data
        fetch('assets/data/concerts-data.json')
            .then(response => response.json())
            .then(data => {
                const concerts = data.concerts || [];
                const now = new Date();

                // Filter and sort upcoming concerts
                const upcomingConcerts = concerts
                    .filter(concert => parseConcertDateTime(concert.date, concert.time) >= now)
                    .sort((a, b) => {
                        const dateA = parseConcertDateTime(a.date, a.time);
                        const dateB = parseConcertDateTime(b.date, b.time);
                        return dateA - dateB;
                    });

                if (upcomingConcerts.length > 0) {
                    const nextConcert = upcomingConcerts[0];
                    const concertEl = document.getElementById('next-concert');

                    // Format the date using shared utility function
                    const formattedDate = formatDate(nextConcert.date);

                    // Create location HTML - hyperlink if Google Maps link exists
                    const locationHTML = nextConcert['google-maps']
                        ? `<a href="${nextConcert['google-maps']}" class="text-gray-700 hover:text-gray-900 underline" target="_blank" rel="noopener">${nextConcert.location}</a>`
                        : `<span class="text-gray-700">${nextConcert.location}</span>`;

                    // Create info button HTML - only for events with "info" property
                    const infoButtonHTML = nextConcert.info
                        ? `<a href="${nextConcert.info}" class="inline-flex items-center gap-1 mt-3 text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors" target="_blank" rel="noopener">More Info <i data-lucide="external-link" class="w-3 h-3"></i></a>`
                        : '';

                    concertEl.innerHTML = `
                        <h3 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-4">${nextConcert.name}</h3>
                        <div class="flex flex-col gap-2 text-base md:text-lg">
                            <div class="flex items-center gap-2">
                                <i data-lucide="calendar" class="w-5 h-5 text-gray-500"></i>
                                <span class="text-gray-700">${formattedDate}</span>
                                ${nextConcert.time ? `<span class="text-gray-400">â€¢</span><i data-lucide="clock" class="w-5 h-5 text-gray-500"></i><span class="text-gray-700">${nextConcert.time}</span>` : ''}
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="map-pin" class="w-5 h-5 text-gray-500"></i>
                                ${locationHTML}
                            </div>
                            ${infoButtonHTML}
                        </div>
                    `;

                    // Initialize Lucide icons for the newly added content
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                } else {
                    document.getElementById('next-concert').innerHTML = `
                        <p class="text-xl text-gray-500 italic">No upcoming concerts scheduled at this time.</p>
                    `;
                }
            })
            .catch(error => console.error('Error loading concert data:', error));
    </script>
</head>
<body class="font-sans text-gray-800">
    <style>
        /* Prevent overscroll bouncing */
        html, body {
            overscroll-behavior-y: none;
        }

        .dissolve-container {
            height: 400vh;
            position: relative;
        }

        .dissolve-sticky {
            position: sticky;
            top: var(--navbar-height, 72px);
            left: 0;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #ffffff;
        }

        .image-wrapper {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 65%; /* 3:2 aspect ratio (2/3 = 0.6667) */
            max-width: 100%;
        }

        .image-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }

        /* Mobile portrait: taller container + crop 10% from each side */
        @media (max-width: 768px) and (orientation: portrait) {
            .image-wrapper {
                padding-bottom: 81%; /* Taller aspect ratio for mobile portrait */
            }

            .image-layer {
                background-size: 125%; /* 100/80 = 125% to show center 80% horizontally */
                background-position: center;
            }
        }

        .image-bottom {
            background-image: url('assets/images/colorwalls.jpg');
        }

        .image-top {
            background-image: url('assets/images/plainwalls.webp');
            opacity: 1;
            transition: opacity 0.1s ease-out;
        }

        .text-overlay {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            width: 90%;
            max-width: 1000px;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .text-overlay h1 {
            font-family: 'Fugaz One', sans-serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 400;
            color: white;
            /* text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8); */
            text-shadow: 8px 8px 1px #000000;
            line-height: 1.2;
            margin: 0;
        }
        .text-overlay h2 {
            font-size: clamp(1.25rem, 3vw, 2rem);
            font-weight: 300;
            color: rgba(255, 255, 255, 0.95);
            /* text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6); */
            line-height: 1.4;
            margin-top: 0.75rem;
        }

        .dark-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            opacity: 0;
            transition: opacity 0.3s ease-out;
            z-index: 5;
        }
    </style>

    <main class="min-h-[calc(100vh-100px)]">

        <!-- Debug Overlay -->
        <!-- To show debug overlay: remove "display: none;" from the style below -->
        <div id="debugOverlay" style="display: none; position: fixed; top: 100px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 15px; font-family: monospace; font-size: 14px; z-index: 9999; border-radius: 5px;">
            <div>Overall Progress: <span id="debugProgress">0</span>%</div>
            <div>Transition Progress: <span id="debugTransition">0</span>%</div>
            <div>Text Progress: <span id="debugText">0</span>%</div>
            <div>Phase: <span id="debugPhase">-</span></div>
        </div>

        <!-- Scroll Dissolve Section -->
        <div class="dissolve-container">
            <div class="dissolve-sticky">
                <div class="image-wrapper">
                    <div class="image-layer image-bottom"></div>
                    <div class="image-layer image-top" id="topImage"></div>
                    <div class="dark-overlay" id="darkOverlay"></div>
                    <div class="text-overlay" id="textOverlay">
                        <h1>Astrodon Quartet</h1>
                    </div>
                </div>

                <!-- Next Concert Section -->
                <div class="w-full bg-gray-50 py-16">
                    <div class="max-w-6xl mx-auto px-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            <!-- Left Column: Concert Details -->
                            <div>
                                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-8">Next Concert:</h2>
                                <div id="next-concert" class="space-y-4">
                                    <!-- Concert info will be loaded here -->
                                </div>
                            </div>

                            <!-- Right Column: Call to Action -->
                            <div class="flex items-center justify-center md:justify-end">
                                <a href="concerts.html" class="inline-block px-10 py-4 bg-gray-900 text-white font-semibold text-lg rounded-lg hover:bg-gray-800 transition-colors no-underline shadow-lg">
                                    View All Concerts
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MVV Fellowship Section -->
                <div class="w-full bg-white py-16 border-t border-gray-200">
                    <div class="max-w-6xl mx-auto px-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            <div class="space-y-6">
                                <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Our Fellowship with Mount Vernon Virtuosi</h2>
                                <p class="text-lg text-gray-700 leading-relaxed">
                                    The Astrodon Quartet is a recipient of Mount Vernon Virtuosi's string quartet fellowship, a Baltimore-based nonprofit
                                    dedicated to free concerts and music education. As fellows, the quartet lives together in MVV's Mars Music House,
                                    performs weekly at community venues throughout Baltimore, and teaches music at local public schools.
                                </p>
                                <a href="about.html#fellowship" class="inline-block px-8 py-3 bg-gray-900 text-white font-semibold text-base rounded-lg hover:bg-gray-800 transition-colors no-underline shadow-md">
                                    Learn More
                                </a>
                            </div>
                            <div class="flex items-center justify-center">
                                <img src="assets/images/tshirts-only.webp" alt="Astrodon Quartet MVV Fellowship" class="rounded-lg w-full max-w-md object-cover">
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script>
        const dissolveContainer = document.querySelector('.dissolve-container');
        const dissolveSticky = document.querySelector('.dissolve-sticky');
        const topImage = document.getElementById('topImage');
        const textOverlay = document.getElementById('textOverlay');
        const darkOverlay = document.getElementById('darkOverlay');

        function handleScroll() {
            const containerRect = dissolveContainer.getBoundingClientRect();
            const containerTop = containerRect.top;
            const containerHeight = containerRect.height;
            const windowHeight = window.innerHeight;

            // Transition timing points (adjust these values to control when each transition occurs)
            const dissolveStart = 0;      // When image dissolve begins (0%)
            const dissolveEnd = 0.75;     // When image dissolve completes (35%)
            const textStart = 0.25;       // When text fade begins (25% - overlaps with dissolve!)
            const textEnd = 0.55;         // When text fade completes (45%)

            // Calculate overall progress through the dissolve section (0 to 1)
            const progress = Math.max(0, Math.min(1, -containerTop / (containerHeight - windowHeight)));

            // Calculate dissolve opacity (1 -> 0)
            let dissolveOpacity;
            if (progress < dissolveStart) {
                dissolveOpacity = 1;
            } else if (progress < dissolveEnd) {
                const dissolveProgress = (progress - dissolveStart) / (dissolveEnd - dissolveStart);
                dissolveOpacity = 1 - dissolveProgress;
            } else {
                dissolveOpacity = 0;
            }

            // Calculate text opacity (0 -> 1)
            let textOpacity;
            if (progress < textStart) {
                textOpacity = 0;
            } else if (progress < textEnd) {
                const textProgress = (progress - textStart) / (textEnd - textStart);
                textOpacity = textProgress;
            } else {
                textOpacity = 1;
            }

            // Apply calculated opacities
            topImage.style.opacity = dissolveOpacity;
            textOverlay.style.opacity = textOpacity;
            darkOverlay.style.opacity = textOpacity;

            // Update debug display
            document.getElementById('debugProgress').textContent = (progress * 100).toFixed(1);
            document.getElementById('debugTransition').textContent = ((1 - dissolveOpacity) * 100).toFixed(1);
            document.getElementById('debugText').textContent = (textOpacity * 100).toFixed(1);

            // Determine and display current phase
            if (progress < textStart) {
                document.getElementById('debugPhase').textContent = 'Dissolve Only';
            } else if (progress < dissolveEnd) {
                document.getElementById('debugPhase').textContent = 'Both (Overlap)';
            } else if (progress < textEnd) {
                document.getElementById('debugPhase').textContent = 'Text Only';
            } else {
                document.getElementById('debugPhase').textContent = 'Complete';
            }
        }

        window.addEventListener('scroll', handleScroll);
        handleScroll(); // Initial call

        // Set navbar height dynamically
        function setNavbarHeight() {
            const navbar = document.querySelector('nav');
            if (navbar) {
                const height = navbar.offsetHeight;
                document.documentElement.style.setProperty('--navbar-height', `${height}px`);
            }
        }

        // Set immediately after navbar loads (components.js inserts it)
        // Use a small delay to ensure navbar is rendered
        setTimeout(setNavbarHeight, 50);

        // Update on window resize
        window.addEventListener('resize', setNavbarHeight);
    </script>
</body>
</html>
